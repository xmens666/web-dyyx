<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº—é“ºè¯¦æƒ… - ä¸œç€›æ¸¸ä¾ </title>
    <meta name="description" content="ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366F1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 50%, #A855F7 100%); }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .product-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.1); }
        .product-card { transition: all 0.3s ease; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed w-full bg-white/95 backdrop-blur-md shadow-sm z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <span class="text-lg font-bold text-gray-800">ğŸ¯ ä¸œç€›æ¸¸ä¾ </span>
            </a>
            <a href="store.html" class="text-indigo-500 text-sm hover:text-indigo-600">
                <i class="fas fa-arrow-left mr-1"></i> è¿”å›åˆ—è¡¨
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="pt-16 pb-24">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading" class="flex flex-col items-center justify-center min-h-[60vh]">
            <div class="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full loading-spinner"></div>
            <p class="mt-4 text-gray-500">æ­£åœ¨åŠ è½½åº—é“ºä¿¡æ¯...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error" class="hidden flex flex-col items-center justify-center min-h-[60vh] px-4">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">åº—é“ºä¸å­˜åœ¨</h2>
            <p class="text-gray-500 mb-6 text-center">è¯¥åº—é“ºå¯èƒ½å·²ä¸‹æ¶æˆ–é“¾æ¥æ— æ•ˆ</p>
            <a href="store.html" class="bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-700 transition">
                è¿”å›åº—é“ºåˆ—è¡¨
            </a>
        </div>

        <!-- åº—é“ºå†…å®¹ -->
        <div id="content" class="hidden fade-in">
            <!-- åº—é“ºå¤´éƒ¨ -->
            <div class="gradient-bg text-white">
                <div class="container mx-auto px-4 py-8 sm:py-12">
                    <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
                        <div class="relative">
                            <img id="storeLogo" src="" alt="åº—é“ºLogo"
                                class="w-24 h-24 sm:w-32 sm:h-32 rounded-2xl object-cover border-4 border-white/30 shadow-lg bg-white">
                            <!-- è¥ä¸šçŠ¶æ€ -->
                            <div id="openStatus" class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap"></div>
                        </div>
                        <div class="text-center sm:text-left flex-1">
                            <div class="flex items-center justify-center sm:justify-start gap-2 mb-2">
                                <h1 id="storeName" class="text-2xl sm:text-3xl font-bold"></h1>
                                <span id="verifiedBadge" class="hidden bg-white/20 text-white px-2 py-0.5 rounded-full text-xs">
                                    <i class="fas fa-check-circle mr-1"></i>å·²è®¤è¯
                                </span>
                            </div>
                            <p id="storeDescription" class="text-white/80 text-sm sm:text-base mb-3 max-w-xl"></p>

                            <!-- è¯„åˆ†å’Œç»Ÿè®¡ -->
                            <div class="flex flex-wrap justify-center sm:justify-start gap-4 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-star text-yellow-300 mr-1"></i>
                                    <span id="storeRating" class="font-bold">5.0</span>
                                    <span class="text-white/60 ml-1">(<span id="reviewCount">0</span>è¯„ä»·)</span>
                                </div>
                                <div class="flex items-center text-white/80">
                                    <i class="fas fa-shopping-bag mr-1"></i>
                                    <span>æœˆé”€ <span id="monthlyOrders" class="font-bold">0</span></span>
                                </div>
                                <div class="flex items-center text-white/80">
                                    <i class="fas fa-eye mr-1"></i>
                                    <span>æµè§ˆ <span id="viewCount" class="font-bold">0</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container mx-auto px-4 py-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- å·¦ä¾§ï¼šå•†å“åˆ—è¡¨ -->
                    <div class="lg:col-span-2">
                        <!-- å•†å“åˆ—è¡¨ -->
                        <div class="mb-8">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-shopping-bag text-indigo-500 mr-2"></i>
                                åº—é“ºå•†å“
                                <span id="productCount" class="ml-2 text-sm font-normal text-gray-500"></span>
                            </h2>
                            <div id="productList" class="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4">
                                <!-- å•†å“å¡ç‰‡å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                            <div id="noProducts" class="hidden text-center py-12 bg-white rounded-xl">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-box-open text-gray-400 text-2xl"></i>
                                </div>
                                <p class="text-gray-500">è¯¥åº—é“ºæš‚æ— å•†å“</p>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šåº—é“ºä¿¡æ¯ -->
                    <div class="space-y-6">
                        <!-- åº—ä¸»ä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-user text-orange-500 mr-2"></i>åº—ä¸»ä¿¡æ¯
                            </h3>
                            <div class="flex items-center gap-3 mb-4">
                                <img id="ownerAvatar" src="" alt="åº—ä¸»å¤´åƒ"
                                    class="w-12 h-12 rounded-full object-cover border-2 border-gray-100">
                                <div>
                                    <p class="font-medium text-gray-800" id="ownerName"></p>
                                    <p class="text-gray-500 text-sm">åº—é“ºåˆ›å»ºäº <span id="createDate"></span></p>
                                </div>
                            </div>
                        </div>

                        <!-- åº—é“ºä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>åº—é“ºä¿¡æ¯
                            </h3>
                            <div class="space-y-3 text-sm">
                                <div id="addressRow" class="flex items-start hidden">
                                    <i class="fas fa-map-marker-alt text-gray-400 w-5 mt-0.5"></i>
                                    <span id="storeAddress" class="text-gray-600 ml-2"></span>
                                </div>
                                <div id="hoursRow" class="flex items-center hidden">
                                    <i class="fas fa-clock text-gray-400 w-5"></i>
                                    <span id="businessHours" class="text-gray-600 ml-2"></span>
                                </div>
                                <!-- è”ç³»æ–¹å¼éšè—ï¼Œå¼•å¯¼ä¸‹è½½APP -->
                                <div class="flex items-center text-gray-400 mt-3 pt-3 border-t border-gray-100">
                                    <i class="fas fa-lock w-5"></i>
                                    <span class="ml-2">ä¸‹è½½APPæŸ¥çœ‹è”ç³»æ–¹å¼</span>
                                </div>
                            </div>
                        </div>

                        <!-- æ”¯ä»˜æ–¹å¼ -->
                        <div id="paymentSection" class="bg-white rounded-xl p-4 shadow-sm hidden">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-credit-card text-green-500 mr-2"></i>æ”¯ä»˜æ–¹å¼
                            </h3>
                            <div id="paymentMethods" class="flex flex-wrap gap-2">
                                <!-- æ”¯ä»˜æ–¹å¼æ ‡ç­¾åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- ç‰¹è‰²æœåŠ¡ -->
                        <div id="servicesSection" class="bg-white rounded-xl p-4 shadow-sm hidden">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-star text-purple-500 mr-2"></i>ç‰¹è‰²æœåŠ¡
                            </h3>
                            <div id="specialServices" class="flex flex-wrap gap-2">
                                <!-- ç‰¹è‰²æœåŠ¡æ ‡ç­¾åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- èµ„è´¨è®¤è¯ -->
                        <div id="certSection" class="bg-white rounded-xl p-4 shadow-sm hidden">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-certificate text-yellow-500 mr-2"></i>èµ„è´¨è®¤è¯
                            </h3>
                            <div id="certifications" class="space-y-2">
                                <!-- è®¤è¯æ ‡ç­¾åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- ä¸‹è½½APPè”ç³» -->
                        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-6 text-white">
                            <div class="text-center">
                                <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-shopping-cart text-2xl"></i>
                                </div>
                                <h3 class="font-bold text-lg mb-2">åœ¨çº¿è´­ç‰©</h3>
                                <p class="text-white/80 text-sm mb-4">ä¸‹è½½APPä¸åº—é“ºåœ¨çº¿æ²Ÿé€šï¼Œä¸‹å•è´­ä¹°å•†å“</p>
                                <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.6.apk" download
                                   class="block bg-white text-indigo-600 py-3 rounded-xl font-bold hover:bg-indigo-50 transition">
                                    <i class="fab fa-android mr-2"></i> ä¸‹è½½APPè´­ç‰©
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åº—é“ºå›¾ç‰‡å±•ç¤º -->
                <div id="imagesSection" class="mt-6 hidden">
                    <div class="bg-white rounded-xl p-6 shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-images text-pink-500 mr-2"></i>åº—é“ºç¯å¢ƒ
                        </h3>
                        <div id="storeImages" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                            <!-- å›¾ç‰‡åŠ¨æ€æ’å…¥ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸‹è½½APPæç¤º -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-8 sm:py-12 mt-8">
                <div class="container mx-auto px-4 text-center">
                    <h3 class="text-xl sm:text-2xl font-bold mb-3">æƒ³è¦è´­ä¹°ï¼Ÿä¸‹è½½ä¸œç€›æ¸¸ä¾ APP</h3>
                    <p class="text-white/80 mb-6 text-sm sm:text-base">åœ¨APPå†…ä¸‹å•è´­ä¹°ï¼Œè”ç³»å–å®¶ï¼Œäº«å—æ›´å¤šæœåŠ¡</p>
                    <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.6.apk" download
                        class="inline-block bg-white text-indigo-600 px-8 py-3 rounded-xl font-bold hover:bg-indigo-50 transition">
                        <i class="fab fa-android mr-2"></i> Android ä¸‹è½½
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å›ºå®šæ  -->
    <div id="bottomBar" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 z-40">
        <div class="container mx-auto flex items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <div class="flex items-center">
                    <i class="fas fa-star text-yellow-500 mr-1"></i>
                    <span id="bottomRating" class="font-bold text-gray-800">5.0</span>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="bottomProductCount">0</span> ä»¶å•†å“
                </div>
            </div>
            <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.6.apk" download
               class="flex-1 max-w-xs bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-center py-3 rounded-xl font-bold hover:opacity-90 transition">
                <i class="fab fa-android mr-2"></i> ä¸‹è½½APPè´­ç‰©
            </a>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm mb-2">ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°</p>
            <p class="text-gray-500 text-xs">&copy; 2026 æ ªå¼ä¼šç¤¾æ˜‡é™½å•†äº‹</p>
        </div>
    </footer>

    <script src="api-config.js"></script>
    <script>
        // è§£æè¥ä¸šæ—¶é—´å¹¶åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨è¥ä¸š
        function isStoreCurrentlyOpen(store) {
            // å¦‚æœ open_status æ˜¯ closedï¼Œç›´æ¥è¿”å› false
            if (store.open_status === 'closed') {
                return false;
            }

            // å¦‚æœæ²¡æœ‰è¥ä¸šæ—¶é—´ä¿¡æ¯ï¼Œæ ¹æ® open_status åˆ¤æ–­
            if (!store.business_hours) {
                return store.open_status === 'open';
            }

            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinute; // è½¬æ¢ä¸ºåˆ†é’Ÿ
            const dayOfWeek = now.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­

            const businessHours = store.business_hours;

            // æ£€æŸ¥æ˜¯å¦æ˜¯å®šä¼‘æ—¥
            const closedDayPatterns = [
                { pattern: /å‘¨ä¸€å®šä¼‘|å‘¨ä¸€ä¼‘|æœˆæ›œå®šä¼‘/i, day: 1 },
                { pattern: /å‘¨äºŒå®šä¼‘|å‘¨äºŒä¼‘|ç«æ›œå®šä¼‘/i, day: 2 },
                { pattern: /å‘¨ä¸‰å®šä¼‘|å‘¨ä¸‰ä¼‘|æ°´æ›œå®šä¼‘/i, day: 3 },
                { pattern: /å‘¨å››å®šä¼‘|å‘¨å››ä¼‘|æœ¨æ›œå®šä¼‘/i, day: 4 },
                { pattern: /å‘¨äº”å®šä¼‘|å‘¨äº”ä¼‘|é‡‘æ›œå®šä¼‘/i, day: 5 },
                { pattern: /å‘¨å…­å®šä¼‘|å‘¨å…­ä¼‘|åœŸæ›œå®šä¼‘/i, day: 6 },
                { pattern: /å‘¨æ—¥å®šä¼‘|å‘¨æ—¥ä¼‘|æ—¥æ›œå®šä¼‘/i, day: 0 },
            ];

            for (const { pattern, day } of closedDayPatterns) {
                if (pattern.test(businessHours) && dayOfWeek === day) {
                    return false;
                }
            }

            // è§£æè¥ä¸šæ—¶é—´èŒƒå›´ (æ”¯æŒæ ¼å¼: 10:00-20:00, 10:00~20:00, 10:00ï½20:00)
            const timeMatch = businessHours.match(/(\d{1,2}):(\d{2})\s*[-~ï½]\s*(\d{1,2}):(\d{2})/);
            if (timeMatch) {
                const openHour = parseInt(timeMatch[1], 10);
                const openMinute = parseInt(timeMatch[2], 10);
                const closeHour = parseInt(timeMatch[3], 10);
                const closeMinute = parseInt(timeMatch[4], 10);

                const openTime = openHour * 60 + openMinute;
                const closeTime = closeHour * 60 + closeMinute;

                // å¤„ç†è·¨å¤œè¥ä¸š (ä¾‹å¦‚ 22:00-02:00)
                if (closeTime < openTime) {
                    return currentTime >= openTime || currentTime < closeTime;
                }

                return currentTime >= openTime && currentTime < closeTime;
            }

            // å¦‚æœæ— æ³•è§£ææ—¶é—´ï¼Œæ ¹æ® open_status åˆ¤æ–­
            return store.open_status === 'open';
        }

        // åˆ¤æ–­åº—é“ºæ˜¯å¦å·²è®¤è¯
        function isStoreVerified(store) {
            return store.verified === true || store.credential_status === 'approved';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const storeId = getUrlParam('id');

            if (!storeId) {
                showError();
                return;
            }

            try {
                const store = await getStoreById(storeId);

                if (!store) {
                    showError();
                    return;
                }

                renderStore(store);

                // åŠ è½½åº—é“ºå•†å“
                const products = await getStoreProducts(storeId);
                renderProducts(products);

            } catch (err) {
                console.error('åŠ è½½åº—é“ºå¤±è´¥:', err);
                showError();
            }
        });

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        function renderStore(store) {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${store.name} - ä¸œç€›æ¸¸ä¾ `;

            // åº—é“ºLogo
            document.getElementById('storeLogo').src = store.logo_url || DEFAULT_STORE_LOGO;
            document.getElementById('storeLogo').onerror = function() { this.src = DEFAULT_STORE_LOGO; };

            // åº—é“ºåç§°
            document.getElementById('storeName').textContent = store.name;
            document.getElementById('storeDescription').textContent = store.description || 'æš‚æ— ç®€ä»‹';

            // è¥ä¸šçŠ¶æ€ - ä½¿ç”¨å®æ—¶è®¡ç®—
            const isOpen = isStoreCurrentlyOpen(store);
            const openStatusEl = document.getElementById('openStatus');
            openStatusEl.textContent = isOpen ? 'è¥ä¸šä¸­' : 'ä¼‘æ¯ä¸­';
            openStatusEl.className = `absolute -bottom-2 left-1/2 transform -translate-x-1/2 px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap ${isOpen ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-600'}`;

            // è®¤è¯å¾½ç«  - æ£€æŸ¥ verified å’Œ credential_status ä¸¤ä¸ªå­—æ®µ
            if (isStoreVerified(store)) {
                document.getElementById('verifiedBadge').classList.remove('hidden');
            }

            // è¯„åˆ†å’Œç»Ÿè®¡
            document.getElementById('storeRating').textContent = store.rating ? parseFloat(store.rating).toFixed(1) : '5.0';
            document.getElementById('reviewCount').textContent = store.review_count || 0;
            document.getElementById('monthlyOrders').textContent = store.monthly_orders || 0;
            document.getElementById('viewCount').textContent = store.view_count || 0;
            document.getElementById('bottomRating').textContent = store.rating ? parseFloat(store.rating).toFixed(1) : '5.0';

            // åº—ä¸»ä¿¡æ¯
            if (store.users) {
                document.getElementById('ownerAvatar').src = store.users.avatar_url || DEFAULT_AVATAR;
                document.getElementById('ownerAvatar').onerror = function() { this.src = DEFAULT_AVATAR; };
                document.getElementById('ownerName').textContent = store.users.nickname || 'åº—ä¸»';
            }
            document.getElementById('createDate').textContent = formatDate(store.created_at);

            // åº—é“ºä¿¡æ¯
            if (store.address) {
                const fullAddress = [store.prefecture, store.city, store.address].filter(Boolean).join(' ');
                document.getElementById('storeAddress').textContent = fullAddress;
                document.getElementById('addressRow').classList.remove('hidden');
            }
            // è”ç³»æ–¹å¼ï¼ˆç”µè¯ã€å¾®ä¿¡ï¼‰å·²éšè—ï¼Œå¼•å¯¼ç”¨æˆ·ä¸‹è½½APP
            if (store.business_hours) {
                document.getElementById('businessHours').textContent = store.business_hours;
                document.getElementById('hoursRow').classList.remove('hidden');
            }

            // æ”¯ä»˜æ–¹å¼
            if (store.payment_methods && store.payment_methods.length > 0) {
                document.getElementById('paymentSection').classList.remove('hidden');
                document.getElementById('paymentMethods').innerHTML = store.payment_methods.map(method =>
                    `<span class="bg-green-50 text-green-600 px-3 py-1 rounded-full text-sm">${method}</span>`
                ).join('');
            }

            // ç‰¹è‰²æœåŠ¡
            if (store.special_services && store.special_services.length > 0) {
                document.getElementById('servicesSection').classList.remove('hidden');
                document.getElementById('specialServices').innerHTML = store.special_services.map(service =>
                    `<span class="bg-purple-50 text-purple-600 px-3 py-1 rounded-full text-sm">${service}</span>`
                ).join('');
            }

            // èµ„è´¨è®¤è¯
            const certs = [];
            if (store.business_license_verified) certs.push({ icon: 'fa-file-contract', text: 'è¥ä¸šæ‰§ç…§å·²è®¤è¯', color: 'green' });
            if (store.id_verified) certs.push({ icon: 'fa-id-card', text: 'èº«ä»½å·²è®¤è¯', color: 'blue' });
            if (store.food_license_verified) certs.push({ icon: 'fa-utensils', text: 'é£Ÿå“ç»è¥è®¸å¯', color: 'orange' });
            if (store.antique_license_verified) certs.push({ icon: 'fa-gem', text: 'å¤ç‰©å•†è®¸å¯', color: 'purple' });

            if (certs.length > 0) {
                document.getElementById('certSection').classList.remove('hidden');
                document.getElementById('certifications').innerHTML = certs.map(cert =>
                    `<div class="flex items-center text-sm">
                        <i class="fas ${cert.icon} text-${cert.color}-500 w-5"></i>
                        <span class="text-gray-600 ml-2">${cert.text}</span>
                        <i class="fas fa-check-circle text-${cert.color}-500 ml-auto"></i>
                    </div>`
                ).join('');
            }

            // åº—é“ºå›¾ç‰‡
            if (store.images && store.images.length > 0) {
                document.getElementById('imagesSection').classList.remove('hidden');
                document.getElementById('storeImages').innerHTML = store.images.map(img =>
                    `<img src="${img}" alt="åº—é“ºå›¾ç‰‡"
                         class="w-full aspect-square object-cover rounded-lg cursor-pointer hover:opacity-90 transition"
                         onclick="window.open('${img}', '_blank')"
                         onerror="this.parentNode.removeChild(this)">`
                ).join('');
            }

            // æ˜¾ç¤ºå†…å®¹
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
        }

        function renderProducts(products) {
            const productList = document.getElementById('productList');
            document.getElementById('productCount').textContent = `(${products.length} ä»¶)`;
            document.getElementById('bottomProductCount').textContent = products.length;

            if (products.length === 0) {
                productList.classList.add('hidden');
                document.getElementById('noProducts').classList.remove('hidden');
                return;
            }

            productList.innerHTML = products.map(product => {
                const image = product.images && product.images.length > 0
                    ? product.images[0]
                    : DEFAULT_PRODUCT_IMAGE;

                // åº“å­˜çŠ¶æ€
                let stockBadge = '';
                if (product.stock_status === 'out_of_stock' || product.stock === 0) {
                    stockBadge = '<span class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">å”®ç½„</span>';
                } else if (product.is_limited) {
                    stockBadge = '<span class="absolute top-2 right-2 bg-orange-500 text-white text-xs px-2 py-1 rounded-full">é™æ—¶</span>';
                } else if (product.is_featured) {
                    stockBadge = '<span class="absolute top-2 right-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">æ¨è</span>';
                }

                // æŠ˜æ‰£
                let discountBadge = '';
                if (product.original_price && product.original_price > product.price) {
                    const discount = Math.round((1 - product.price / product.original_price) * 100);
                    discountBadge = `<span class="text-xs bg-red-100 text-red-500 px-1.5 py-0.5 rounded ml-2">${discount}%OFF</span>`;
                }

                return `
                    <div class="product-card bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100">
                        <div class="aspect-square bg-gray-100 relative">
                            <img src="${image}" alt="${product.name}"
                                 class="w-full h-full object-cover"
                                 onerror="this.src=DEFAULT_PRODUCT_IMAGE">
                            ${stockBadge}
                        </div>
                        <div class="p-3">
                            <h3 class="font-medium text-gray-800 text-sm mb-2 line-clamp-2">${product.name}</h3>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-red-500 font-bold">${formatPrice(product.price)}</span>
                                    ${discountBadge}
                                </div>
                            </div>
                            ${product.original_price && product.original_price > product.price ?
                                `<span class="text-xs text-gray-400 line-through">${formatPrice(product.original_price)}</span>` : ''}
                            <div class="flex items-center justify-between mt-2 text-xs text-gray-400">
                                <span>/${product.unit || 'ä»¶'}</span>
                                ${product.monthly_sales ? `<span>æœˆé”€ ${product.monthly_sales}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
