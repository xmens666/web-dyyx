<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡è¯¦æƒ… - ä¸œç€›æ¸¸ä¾ </title>
    <meta name="description" content="ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10B981">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-service { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
        .tag { display: inline-block; padding: 4px 12px; border-radius: 9999px; font-size: 12px; margin-right: 8px; margin-bottom: 8px; }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed w-full bg-white/95 backdrop-blur-md shadow-sm z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <span class="text-lg font-bold text-gray-800">ğŸ¯ ä¸œç€›æ¸¸ä¾ </span>
            </a>
            <a href="service.html" class="text-emerald-500 text-sm hover:text-emerald-600">
                <i class="fas fa-arrow-left mr-1"></i> è¿”å›åˆ—è¡¨
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="pt-16 pb-24">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading" class="flex flex-col items-center justify-center min-h-[60vh]">
            <div class="w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full loading-spinner"></div>
            <p class="mt-4 text-gray-500">æ­£åœ¨åŠ è½½æœåŠ¡ä¿¡æ¯...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error" class="hidden flex flex-col items-center justify-center min-h-[60vh] px-4">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">æœåŠ¡ä¸å­˜åœ¨</h2>
            <p class="text-gray-500 mb-6 text-center">è¯¥æœåŠ¡å¯èƒ½å·²ä¸‹æ¶æˆ–é“¾æ¥æ— æ•ˆ</p>
            <a href="service.html" class="bg-emerald-500 text-white px-6 py-2 rounded-full hover:bg-emerald-600 transition">
                è¿”å›åˆ—è¡¨
            </a>
        </div>

        <!-- æœåŠ¡å†…å®¹ -->
        <div id="content" class="hidden fade-in">
            <!-- æœåŠ¡å¤´éƒ¨ -->
            <div class="gradient-service text-white">
                <div class="container mx-auto px-4 py-8 sm:py-12">
                    <div class="flex flex-col sm:flex-row items-start gap-4 sm:gap-6">
                        <!-- æœåŠ¡å›¾ç‰‡ -->
                        <div class="w-full sm:w-48 flex-shrink-0">
                            <img id="serviceImage" src="" alt="æœåŠ¡å›¾ç‰‡"
                                 class="w-full aspect-video sm:aspect-square rounded-xl object-cover shadow-lg">
                        </div>
                        <div class="flex-1">
                            <h1 id="serviceName" class="text-2xl sm:text-3xl font-bold mb-3"></h1>
                            <div id="serviceTags" class="mb-3">
                                <!-- æ ‡ç­¾å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                            <div class="flex items-baseline gap-2 mb-4">
                                <span class="text-3xl font-bold" id="servicePrice"></span>
                                <span id="priceUnit" class="text-white/70"></span>
                            </div>
                            <div class="flex flex-wrap gap-4 text-sm text-white/80">
                                <span id="serviceArea"><i class="fas fa-map-marker-alt mr-1"></i></span>
                                <span id="serviceType"><i class="fas fa-tools mr-1"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container mx-auto px-4 py-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- å·¦ä¾§ï¼šæœåŠ¡è¯¦æƒ… -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- æœåŠ¡æè¿° -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-green-500 mr-2"></i>
                                æœåŠ¡è¯¦æƒ…
                            </h2>
                            <div id="serviceDescription" class="text-gray-700 whitespace-pre-wrap">
                                <!-- æœåŠ¡æè¿°å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- æœåŠ¡åŒºåŸŸ -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-map text-blue-500 mr-2"></i>
                                æœåŠ¡åŒºåŸŸ
                            </h2>
                            <p id="serviceAreaDetail" class="text-gray-700"></p>
                        </div>

                        <!-- æœåŠ¡å›¾ç‰‡å±•ç¤º -->
                        <div id="serviceImagesSection" class="bg-white rounded-xl p-6 shadow-sm hidden">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-images text-purple-500 mr-2"></i>
                                æœåŠ¡å±•ç¤º
                            </h2>
                            <div id="serviceImages" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                <!-- å›¾ç‰‡å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šæœåŠ¡å•†ä¿¡æ¯ -->
                    <div class="space-y-6">
                        <!-- æœåŠ¡å•†å¡ç‰‡ -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-user text-orange-500 mr-2"></i>
                                æœåŠ¡å•†
                            </h2>
                            <div class="flex items-center gap-4 mb-4">
                                <img id="providerAvatar" src="" alt="å¤´åƒ"
                                     class="w-16 h-16 rounded-full object-cover border-2 border-gray-100">
                                <div>
                                    <h3 id="providerName" class="font-bold text-gray-800"></h3>
                                    <p id="providerBio" class="text-gray-500 text-sm"></p>
                                </div>
                            </div>
                            <div class="border-t border-gray-100 pt-4">
                                <p class="text-gray-500 text-sm mb-2">
                                    <i class="fas fa-clock mr-2"></i>
                                    <span id="responseTime">é€šå¸¸åœ¨1å°æ—¶å†…å›å¤</span>
                                </p>
                            </div>
                        </div>

                        <!-- ä¸‹è½½APPè”ç³» -->
                        <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-6 text-white">
                            <div class="text-center">
                                <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-comments text-2xl"></i>
                                </div>
                                <h3 class="font-bold text-lg mb-2">è”ç³»æœåŠ¡å•†</h3>
                                <p class="text-white/80 text-sm mb-4">ä¸‹è½½APPä¸æœåŠ¡å•†åœ¨çº¿æ²Ÿé€šï¼Œé¢„çº¦æœåŠ¡</p>
                                <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.6.apk" download
                                   class="block bg-white text-green-600 py-3 rounded-xl font-bold hover:bg-green-50 transition">
                                    <i class="fab fa-android mr-2"></i> ä¸‹è½½APPè”ç³»
                                </a>
                            </div>
                        </div>

                        <!-- æ¸©é¦¨æç¤º -->
                        <div class="bg-yellow-50 rounded-xl p-4 border border-yellow-100">
                            <h4 class="font-medium text-yellow-800 mb-2 flex items-center">
                                <i class="fas fa-lightbulb mr-2"></i>
                                æ¸©é¦¨æç¤º
                            </h4>
                            <ul class="text-yellow-700 text-sm space-y-1">
                                <li>â€¢ è¯·åœ¨APPå†…ä¸æœåŠ¡å•†æ²Ÿé€šç¡®è®¤æœåŠ¡ç»†èŠ‚</li>
                                <li>â€¢ æ”¯æŒå¹³å°æ‹…ä¿äº¤æ˜“ï¼Œå®‰å…¨æœ‰ä¿éšœ</li>
                                <li>â€¢ æœåŠ¡å®Œæˆåè¯·åŠæ—¶ç¡®è®¤å¹¶è¯„ä»·</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å›ºå®šæ  -->
    <div id="bottomBar" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 z-40">
        <div class="container mx-auto flex items-center justify-between gap-4">
            <div class="flex-shrink-0">
                <p class="text-gray-500 text-xs">æœåŠ¡ä»·æ ¼</p>
                <p class="text-red-500 font-bold text-xl" id="bottomPrice"></p>
            </div>
            <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.6.apk" download
               class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-center py-3 rounded-xl font-bold hover:opacity-90 transition">
                <i class="fab fa-android mr-2"></i> ä¸‹è½½APPé¢„çº¦
            </a>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm mb-2">ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°</p>
            <p class="text-gray-500 text-xs">&copy; 2026 æ ªå¼ä¼šç¤¾æ˜‡é™½å•†äº‹</p>
        </div>
    </footer>

    <!-- APIé…ç½® -->
    <script src="api-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const serviceId = getUrlParam('id');

            if (!serviceId) {
                showError();
                return;
            }

            try {
                const service = await getServiceById(serviceId);

                if (!service) {
                    showError();
                    return;
                }

                renderService(service);

            } catch (err) {
                console.error('åŠ è½½æœåŠ¡å¤±è´¥:', err);
                showError();
            }
        });

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        function renderService(service) {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${service.title} - ä¸œç€›æ¸¸ä¾ `;

            // æœåŠ¡å›¾ç‰‡
            const mainImage = getServiceImage(service);
            document.getElementById('serviceImage').src = mainImage;

            // æœåŠ¡ä¿¡æ¯
            document.getElementById('serviceName').textContent = service.title;
            document.getElementById('servicePrice').textContent = formatServicePrice(service);
            document.getElementById('priceUnit').textContent = getPriceUnit(service);
            document.getElementById('bottomPrice').textContent = formatServicePrice(service);

            // æœåŠ¡ç±»å‹å’ŒåŒºåŸŸ
            document.getElementById('serviceArea').innerHTML = `<i class="fas fa-map-marker-alt mr-1"></i>${service.service_area || 'å…¨å›½'}`;
            document.getElementById('serviceType').innerHTML = `<i class="fas fa-tools mr-1"></i>${getServiceTypeName(service.service_type)}`;

            // æ ‡ç­¾
            const tagsContainer = document.getElementById('serviceTags');
            if (service.tags && service.tags.length > 0) {
                tagsContainer.innerHTML = service.tags.map(tag =>
                    `<span class="tag bg-white/20">${tag}</span>`
                ).join('');
            } else {
                tagsContainer.innerHTML = `<span class="tag bg-white/20">${getServiceTypeName(service.service_type)}</span>`;
            }

            // æœåŠ¡æè¿°
            document.getElementById('serviceDescription').textContent = service.description || 'æš‚æ— è¯¦ç»†æè¿°';

            // æœåŠ¡åŒºåŸŸè¯¦æƒ…
            document.getElementById('serviceAreaDetail').textContent = service.service_area || 'æœåŠ¡èŒƒå›´ï¼šå…¨æ—¥æœ¬';

            // æœåŠ¡å›¾ç‰‡å±•ç¤º
            if (service.images && service.images.length > 0) {
                document.getElementById('serviceImagesSection').classList.remove('hidden');
                document.getElementById('serviceImages').innerHTML = service.images.map(img =>
                    `<img src="${img}" alt="æœåŠ¡å±•ç¤º" class="rounded-lg aspect-square object-cover cursor-pointer hover:opacity-90 transition"
                          onclick="window.open('${img}', '_blank')">`
                ).join('');
            }

            // æœåŠ¡å•†ä¿¡æ¯
            if (service.users) {
                const user = service.users;
                document.getElementById('providerAvatar').src = user.avatar_url || DEFAULT_AVATAR;
                document.getElementById('providerName').textContent = user.nickname || 'æœåŠ¡å•†';
                document.getElementById('providerBio').textContent = 'ä¸“ä¸šæœåŠ¡ï¼Œç”¨å¿ƒå¯¹å¾…æ¯ä¸€ä½å®¢æˆ·';
            }

            // æ˜¾ç¤ºå†…å®¹
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
        }

        function getServiceImage(service) {
            if (service.images && service.images.length > 0) {
                return service.images[0];
            }
            if (service.cover_image) {
                return service.cover_image;
            }
            return DEFAULT_PRODUCT_IMAGE;
        }

        function formatServicePrice(service) {
            if (service.price_type === 'negotiable' || !service.price) {
                return 'é¢è®®';
            }
            return formatPrice(service.price);
        }

        function getPriceUnit(service) {
            if (service.price_type === 'negotiable') return '';
            if (service.price_type === 'hourly') return '/å°æ—¶';
            if (service.price_type === 'daily') return '/å¤©';
            if (service.price_type === 'per_time') return '/æ¬¡';
            return '';
        }

        function getServiceTypeName(type) {
            const types = {
                'moving': 'æ¬å®¶æœåŠ¡',
                'cleaning': 'æ¸…æ´ä¿æ´',
                'repair': 'ç»´ä¿®æœåŠ¡',
                'translation': 'ç¿»è¯‘æœåŠ¡',
                'driving': 'ä»£é©¾æ¥é€',
                'shopping': 'ä»£è´­è·‘è…¿',
                'teaching': 'æ•™å­¦åŸ¹è®­',
                'beauty': 'ç¾å®¹ç¾å‘',
                'photography': 'æ‘„å½±æ‘„åƒ',
                'other': 'å…¶ä»–æœåŠ¡'
            };
            return types[type] || type || 'ç”Ÿæ´»æœåŠ¡';
        }
    </script>
</body>

</html>
