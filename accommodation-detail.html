<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿æºè¯¦æƒ… - ä¸œç€›æ¸¸ä¾ </title>
    <meta name="description" content="ä¸œç€›æ¸¸ä¾ å®¢æ ˆé©¿ç«™ - åœ¨æ—¥åäººæˆ¿å±‹ç§Ÿèµå¹³å°">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366F1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-accommodation { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 50%, #A855F7 100%); }
        .facility-tag { display: inline-flex; align-items: center; padding: 6px 12px; border-radius: 8px; font-size: 13px; margin: 4px; background: #F3F4F6; color: #4B5563; }
        .facility-tag i { margin-right: 6px; color: #6366F1; }
        .image-slider { scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .image-slider > div { scroll-snap-align: start; flex-shrink: 0; }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed w-full bg-white/95 backdrop-blur-md shadow-sm z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <span class="text-lg font-bold text-gray-800">ğŸ¯ ä¸œç€›æ¸¸ä¾ </span>
            </a>
            <a href="accommodation.html" class="text-indigo-500 text-sm hover:text-indigo-600">
                <i class="fas fa-arrow-left mr-1"></i> è¿”å›åˆ—è¡¨
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="pt-16 pb-24">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading" class="flex flex-col items-center justify-center min-h-[60vh]">
            <div class="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full loading-spinner"></div>
            <p class="mt-4 text-gray-500">æ­£åœ¨åŠ è½½æˆ¿æºä¿¡æ¯...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error" class="hidden flex flex-col items-center justify-center min-h-[60vh] px-4">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">æˆ¿æºä¸å­˜åœ¨</h2>
            <p class="text-gray-500 mb-6 text-center">è¯¥æˆ¿æºå¯èƒ½å·²ä¸‹æ¶æˆ–é“¾æ¥æ— æ•ˆ</p>
            <a href="accommodation.html" class="bg-indigo-500 text-white px-6 py-2 rounded-full hover:bg-indigo-600 transition">
                è¿”å›åˆ—è¡¨
            </a>
        </div>

        <!-- æˆ¿æºå†…å®¹ -->
        <div id="content" class="hidden fade-in">
            <!-- å›¾ç‰‡è½®æ’­ -->
            <div class="relative bg-black">
                <div id="imageSlider" class="image-slider flex overflow-x-auto">
                    <!-- å›¾ç‰‡å°†åŠ¨æ€æ’å…¥ -->
                </div>
                <div id="imageCounter" class="absolute bottom-4 right-4 bg-black/60 text-white px-3 py-1 rounded-full text-sm">
                    1 / 1
                </div>
            </div>

            <div class="container mx-auto px-4 py-6">
                <!-- æˆ¿æºæ ‡é¢˜åŒº -->
                <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
                    <div class="flex flex-wrap gap-2 mb-3">
                        <span id="typeTag" class="px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-700"></span>
                        <span id="statusTag" class="px-3 py-1 rounded-full text-xs font-medium"></span>
                    </div>
                    <h1 id="accommodationTitle" class="text-xl sm:text-2xl font-bold text-gray-900 mb-3"></h1>
                    <p id="accommodationAddress" class="text-gray-500 text-sm mb-4">
                        <i class="fas fa-map-marker-alt mr-1"></i>
                    </p>

                    <!-- ä»·æ ¼ -->
                    <div class="flex items-baseline gap-2">
                        <span class="text-3xl sm:text-4xl font-bold text-red-500" id="accommodationPrice"></span>
                        <span class="text-gray-500" id="priceUnit">/æœˆ</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- å·¦ä¾§ï¼šæˆ¿æºè¯¦æƒ… -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- åŸºæœ¬å‚æ•° -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-home text-indigo-500 mr-2"></i>
                                æˆ¿å±‹ä¿¡æ¯
                            </h2>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <p class="text-gray-500 text-xs mb-1">æˆ·å‹</p>
                                    <p id="roomLayout" class="font-bold text-gray-800"></p>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <p class="text-gray-500 text-xs mb-1">é¢ç§¯</p>
                                    <p id="roomArea" class="font-bold text-gray-800"></p>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <p class="text-gray-500 text-xs mb-1">æ¥¼å±‚</p>
                                    <p id="roomFloor" class="font-bold text-gray-800"></p>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <p class="text-gray-500 text-xs mb-1">æœå‘</p>
                                    <p id="roomDirection" class="font-bold text-gray-800"></p>
                                </div>
                            </div>
                        </div>

                        <!-- è¯¦ç»†ä»‹ç» -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                æˆ¿æºä»‹ç»
                            </h2>
                            <p id="accommodationDescription" class="text-gray-700 whitespace-pre-wrap"></p>
                        </div>

                        <!-- é…å¥—è®¾æ–½ -->
                        <div id="facilitiesSection" class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-couch text-purple-500 mr-2"></i>
                                é…å¥—è®¾æ–½
                            </h2>
                            <div id="facilitiesList" class="flex flex-wrap">
                                <!-- è®¾æ–½å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- è´¹ç”¨æ˜ç»† -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-yen-sign text-green-500 mr-2"></i>
                                è´¹ç”¨æ˜ç»†
                            </h2>
                            <div class="space-y-3">
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-500">æœˆç§Ÿé‡‘</span>
                                    <span id="feeRent" class="font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-500">æŠ¼é‡‘/æ•·é‡‘</span>
                                    <span id="feeDeposit" class="font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-500">ç¤¼é‡‘</span>
                                    <span id="feeGift" class="font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-500">ç®¡ç†è´¹</span>
                                    <span id="feeMaintenance" class="font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between py-2">
                                    <span class="text-gray-500">å…¥ä½æ—¥æœŸ</span>
                                    <span id="moveInDate" class="font-medium text-gray-800"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šè”ç³»ä¿¡æ¯ -->
                    <div class="space-y-6">
                        <!-- æˆ¿ä¸œä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-user text-orange-500 mr-2"></i>
                                å‘å¸ƒè€…
                            </h2>
                            <div class="flex items-center gap-4 mb-4">
                                <img id="ownerAvatar" src="" alt="å¤´åƒ"
                                     class="w-14 h-14 rounded-full object-cover border-2 border-gray-100">
                                <div>
                                    <h3 id="ownerName" class="font-bold text-gray-800"></h3>
                                    <p id="ownerType" class="text-gray-500 text-sm"></p>
                                </div>
                            </div>
                        </div>

                        <!-- ä¸‹è½½APPè”ç³» -->
                        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-6 text-white">
                            <div class="text-center">
                                <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-comments text-2xl"></i>
                                </div>
                                <h3 class="font-bold text-lg mb-2">è”ç³»æˆ¿ä¸œçœ‹æˆ¿</h3>
                                <p class="text-white/80 text-sm mb-4">ä¸‹è½½APPä¸æˆ¿ä¸œç›´æ¥æ²Ÿé€šï¼Œé¢„çº¦çœ‹æˆ¿</p>
                                <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/dongyingyouxia_v1.4.5_test.apk" download
                                   class="block bg-white text-indigo-600 py-3 rounded-xl font-bold hover:bg-indigo-50 transition">
                                    <i class="fab fa-android mr-2"></i> ä¸‹è½½APPè”ç³»
                                </a>
                            </div>
                        </div>

                        <!-- çœ‹æˆ¿æç¤º -->
                        <div class="bg-yellow-50 rounded-xl p-4 border border-yellow-100">
                            <h4 class="font-medium text-yellow-800 mb-2 flex items-center">
                                <i class="fas fa-lightbulb mr-2"></i>
                                çœ‹æˆ¿æç¤º
                            </h4>
                            <ul class="text-yellow-700 text-sm space-y-1">
                                <li>â€¢ å®åœ°çœ‹æˆ¿å‰è¯·å…ˆè”ç³»ç¡®è®¤</li>
                                <li>â€¢ ç­¾çº¦å‰è¯·æ ¸å®æˆ¿æºçœŸå®æ€§</li>
                                <li>â€¢ å¹³å°æä¾›æ‹…ä¿äº¤æ˜“ä¿éšœ</li>
                                <li>â€¢ å¦‚é‡é—®é¢˜å¯è”ç³»å®¢æœå¤„ç†</li>
                            </ul>
                        </div>

                        <!-- ä½ç½®ä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-train text-blue-500 mr-2"></i>
                                äº¤é€šä¿¡æ¯
                            </h2>
                            <p id="nearStation" class="text-gray-700 mb-2"></p>
                            <p id="walkTime" class="text-gray-500 text-sm"></p>
                            <a id="mapLink" href="#" target="_blank"
                               class="block text-center bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200 transition mt-4">
                                <i class="fas fa-external-link-alt mr-2"></i>åœ¨åœ°å›¾ä¸­æŸ¥çœ‹
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å›ºå®šæ  -->
    <div id="bottomBar" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 z-40">
        <div class="container mx-auto flex items-center justify-between gap-4">
            <div class="flex-shrink-0">
                <p class="text-gray-500 text-xs">æœˆç§Ÿé‡‘</p>
                <p class="text-red-500 font-bold text-xl" id="bottomPrice"></p>
            </div>
            <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/dongyingyouxia_v1.4.5_test.apk" download
               class="flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-center py-3 rounded-xl font-bold hover:opacity-90 transition">
                <i class="fab fa-android mr-2"></i> ä¸‹è½½APPçœ‹æˆ¿
            </a>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm mb-2">ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°</p>
            <p class="text-gray-500 text-xs">&copy; 2026 æ ªå¼ä¼šç¤¾æ˜‡é™½å•†äº‹</p>
        </div>
    </footer>

    <!-- APIé…ç½® -->
    <script src="api-config.js"></script>
    <script>
        let accommodationImages = [];
        let currentImageIndex = 0;

        document.addEventListener('DOMContentLoaded', async () => {
            const accommodationId = getUrlParam('id');

            if (!accommodationId) {
                showError();
                return;
            }

            try {
                const accommodation = await getAccommodationById(accommodationId);

                if (!accommodation) {
                    showError();
                    return;
                }

                renderAccommodation(accommodation);

            } catch (err) {
                console.error('åŠ è½½æˆ¿æºå¤±è´¥:', err);
                showError();
            }
        });

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        function renderAccommodation(accommodation) {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${accommodation.title} - å®¢æ ˆé©¿ç«™`;

            // å¤„ç†å›¾ç‰‡
            accommodationImages = [];
            if (accommodation.images && accommodation.images.length > 0) {
                accommodationImages = accommodation.images;
            } else {
                accommodationImages = [DEFAULT_PRODUCT_IMAGE];
            }

            // å›¾ç‰‡è½®æ’­
            const imageSlider = document.getElementById('imageSlider');
            imageSlider.innerHTML = accommodationImages.map((img, index) => `
                <div class="w-full flex-shrink-0">
                    <img src="${img}" alt="æˆ¿æºå›¾ç‰‡${index + 1}"
                         class="w-full aspect-video object-cover"
                         onerror="this.src='${DEFAULT_PRODUCT_IMAGE}'">
                </div>
            `).join('');
            document.getElementById('imageCounter').textContent = `1 / ${accommodationImages.length}`;

            // å›¾ç‰‡æ»šåŠ¨ç›‘å¬
            imageSlider.addEventListener('scroll', () => {
                const index = Math.round(imageSlider.scrollLeft / imageSlider.clientWidth);
                document.getElementById('imageCounter').textContent = `${index + 1} / ${accommodationImages.length}`;
            });

            // ç±»å‹æ ‡ç­¾
            document.getElementById('typeTag').textContent = getAccommodationType(accommodation.accommodation_type);

            // çŠ¶æ€æ ‡ç­¾
            const statusTag = document.getElementById('statusTag');
            if (accommodation.status === 'active') {
                statusTag.textContent = 'å¯ç§Ÿ';
                statusTag.classList.add('bg-green-100', 'text-green-700');
            } else {
                statusTag.textContent = 'å·²ç§Ÿå‡º';
                statusTag.classList.add('bg-gray-100', 'text-gray-700');
            }

            // åŸºæœ¬ä¿¡æ¯
            document.getElementById('accommodationTitle').textContent = accommodation.title;
            document.getElementById('accommodationAddress').innerHTML = `<i class="fas fa-map-marker-alt mr-1"></i>${accommodation.address || 'è¯¦ç»†åœ°å€è¯·å’¨è¯¢'}`;

            // ä»·æ ¼
            const price = accommodation.price || accommodation.rent;
            document.getElementById('accommodationPrice').textContent = formatPrice(price);
            document.getElementById('bottomPrice').textContent = formatPrice(price);

            // ä»·æ ¼å•ä½
            const priceType = accommodation.price_type || 'monthly';
            const priceUnits = {
                'monthly': '/æœˆ',
                'daily': '/å¤©',
                'yearly': '/å¹´'
            };
            document.getElementById('priceUnit').textContent = priceUnits[priceType] || '/æœˆ';

            // æˆ¿å±‹å‚æ•°
            document.getElementById('roomLayout').textContent = accommodation.layout || accommodation.room_layout || '-';
            document.getElementById('roomArea').textContent = accommodation.area ? `${accommodation.area}ã¡` : '-';
            document.getElementById('roomFloor').textContent = accommodation.floor ? `${accommodation.floor}F` : '-';
            document.getElementById('roomDirection').textContent = accommodation.direction || '-';

            // è¯¦ç»†ä»‹ç»
            document.getElementById('accommodationDescription').textContent = accommodation.description || 'æš‚æ— è¯¦ç»†ä»‹ç»';

            // é…å¥—è®¾æ–½
            const facilitiesList = document.getElementById('facilitiesList');
            const facilities = accommodation.facilities || accommodation.amenities || [];
            if (facilities.length > 0) {
                facilitiesList.innerHTML = facilities.map(facility => `
                    <span class="facility-tag">
                        <i class="${getFacilityIcon(facility)}"></i>${facility}
                    </span>
                `).join('');
            } else {
                document.getElementById('facilitiesSection').classList.add('hidden');
            }

            // è´¹ç”¨æ˜ç»†
            document.getElementById('feeRent').textContent = formatPrice(price);
            document.getElementById('feeDeposit').textContent = formatPrice(accommodation.deposit) || 'æ— ';
            document.getElementById('feeGift').textContent = formatPrice(accommodation.gift_money) || 'æ— ';
            document.getElementById('feeMaintenance').textContent = formatPrice(accommodation.maintenance_fee) || 'æ— ';
            document.getElementById('moveInDate').textContent = accommodation.move_in_date ? formatDate(accommodation.move_in_date) : 'å³å¯å…¥ä½';

            // æˆ¿ä¸œä¿¡æ¯
            if (accommodation.users) {
                const user = accommodation.users;
                document.getElementById('ownerAvatar').src = user.avatar_url || DEFAULT_AVATAR;
                document.getElementById('ownerName').textContent = user.nickname || 'æˆ¿ä¸œ';
                document.getElementById('ownerType').textContent = accommodation.owner_type === 'agent' ? 'æˆ¿äº§ä¸­ä»‹' : 'ä¸ªäººæˆ¿ä¸œ';
            }

            // äº¤é€šä¿¡æ¯
            document.getElementById('nearStation').textContent = accommodation.nearest_station
                ? `æœ€è¿‘è½¦ç«™: ${accommodation.nearest_station}`
                : 'è¯¦æƒ…è¯·å’¨è¯¢';
            document.getElementById('walkTime').textContent = accommodation.walk_time
                ? `æ­¥è¡Œçº¦ ${accommodation.walk_time} åˆ†é’Ÿ`
                : '';

            // åœ°å›¾é“¾æ¥
            if (accommodation.address) {
                document.getElementById('mapLink').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(accommodation.address)}`;
            }

            // æ˜¾ç¤ºå†…å®¹
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
        }

        function getAccommodationType(type) {
            const types = {
                'rent': 'æ•´ç§Ÿ',
                'sharehouse': 'åˆç§Ÿ',
                'homestay': 'æ°‘å®¿',
                'sale': 'æˆ¿å±‹ä¹°å–',
                'office': 'åŠå…¬å®¤',
                'warehouse': 'ä»“åº“',
                'land_rent': 'åœŸåœ°ç§Ÿèµ',
                'land_sale': 'åœŸåœ°ä¹°å–',
                'apartment': 'å…¬å¯“',
                'house': 'ä¸€æˆ·å»º',
                'mansion': 'ãƒãƒ³ã‚·ãƒ§ãƒ³'
            };
            return types[type] || type || 'æˆ¿æº';
        }

        function getFacilityIcon(facility) {
            const icons = {
                'ç©ºè°ƒ': 'fas fa-snowflake',
                'æ´—è¡£æœº': 'fas fa-tshirt',
                'å†°ç®±': 'fas fa-box',
                'WiFi': 'fas fa-wifi',
                'ç½‘ç»œ': 'fas fa-wifi',
                'ç”µè§†': 'fas fa-tv',
                'å¨æˆ¿': 'fas fa-utensils',
                'å«ç”Ÿé—´': 'fas fa-toilet',
                'æµ´å®¤': 'fas fa-bath',
                'é˜³å°': 'fas fa-sun',
                'åœè½¦ä½': 'fas fa-parking',
                'ç”µæ¢¯': 'fas fa-elevator',
                'å® ç‰©': 'fas fa-paw',
                'å®¶å…·': 'fas fa-couch'
            };
            for (const [key, icon] of Object.entries(icons)) {
                if (facility.includes(key)) return icon;
            }
            return 'fas fa-check';
        }
    </script>
</body>

</html>
