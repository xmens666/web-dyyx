<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾ç¾¤è¯¦æƒ… - ä¸œç€›æ¸¸ä¾ </title>
    <meta name="description" content="ä¸œç€›æ¸¸ä¾ è‹±é›„ç»“ä¹‰ - åœ¨æ—¥åäººç¤¾ç¾¤å¹³å°">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#14B8A6">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-club { background: linear-gradient(135deg, #14B8A6 0%, #0D9488 50%, #0F766E 100%); }
        .gradient-hometown { background: linear-gradient(135deg, #F43F5E 0%, #E11D48 50%, #BE123C 100%); }
        .member-avatar { transition: all 0.3s ease; }
        .member-avatar:hover { transform: scale(1.1); z-index: 10; }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed w-full bg-white/95 backdrop-blur-md shadow-sm z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <span class="text-lg font-bold text-gray-800">ğŸ¯ ä¸œç€›æ¸¸ä¾ </span>
            </a>
            <a href="community.html" class="text-teal-500 text-sm hover:text-teal-600">
                <i class="fas fa-arrow-left mr-1"></i> è¿”å›åˆ—è¡¨
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="pt-16 pb-24">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading" class="flex flex-col items-center justify-center min-h-[60vh]">
            <div class="w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full loading-spinner"></div>
            <p class="mt-4 text-gray-500">æ­£åœ¨åŠ è½½ç¤¾ç¾¤ä¿¡æ¯...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error" class="hidden flex flex-col items-center justify-center min-h-[60vh] px-4">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">ç¤¾ç¾¤ä¸å­˜åœ¨</h2>
            <p class="text-gray-500 mb-6 text-center">è¯¥ç¤¾ç¾¤å¯èƒ½å·²è§£æ•£æˆ–é“¾æ¥æ— æ•ˆ</p>
            <a href="community.html" class="bg-teal-500 text-white px-6 py-2 rounded-full hover:bg-teal-600 transition">
                è¿”å›åˆ—è¡¨
            </a>
        </div>

        <!-- ç¤¾ç¾¤å†…å®¹ -->
        <div id="content" class="hidden fade-in">
            <!-- ç¤¾ç¾¤å¤´éƒ¨ -->
            <div id="communityHeader" class="gradient-club text-white">
                <div class="container mx-auto px-4 py-8 sm:py-12">
                    <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
                        <!-- ç¤¾ç¾¤å¤´åƒ -->
                        <div class="relative">
                            <img id="communityLogo" src="" alt="ç¤¾ç¾¤å¤´åƒ"
                                 class="w-24 h-24 sm:w-32 sm:h-32 rounded-2xl object-cover border-4 border-white/30 shadow-lg">
                            <div id="communityBadge" class="absolute -bottom-2 -right-2 w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center shadow">
                                <i class="fas fa-crown text-white text-sm"></i>
                            </div>
                        </div>
                        <div class="text-center sm:text-left flex-1">
                            <div class="flex items-center justify-center sm:justify-start gap-2 mb-2">
                                <span id="communityTypeTag" class="px-3 py-1 rounded-full text-xs font-medium bg-white/20"></span>
                            </div>
                            <h1 id="communityName" class="text-2xl sm:text-3xl font-bold mb-2"></h1>
                            <p id="communitySlogan" class="text-white/80 text-sm sm:text-base mb-3"></p>
                            <div class="flex flex-wrap justify-center sm:justify-start gap-4 text-sm">
                                <span id="memberCount" class="bg-white/20 px-3 py-1 rounded-full"></span>
                                <span id="createDate" class="bg-white/20 px-3 py-1 rounded-full"></span>
                                <span id="activityLevel" class="bg-white/20 px-3 py-1 rounded-full"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container mx-auto px-4 py-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- å·¦ä¾§ï¼šç¤¾ç¾¤è¯¦æƒ… -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- ç¤¾ç¾¤ç®€ä»‹ -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-teal-500 mr-2"></i>
                                ç¤¾ç¾¤ç®€ä»‹
                            </h2>
                            <p id="communityDescription" class="text-gray-700 whitespace-pre-wrap"></p>
                        </div>

                        <!-- æˆå‘˜å±•ç¤º -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-users text-blue-500 mr-2"></i>
                                æˆå‘˜é£é‡‡
                            </h2>
                            <div id="memberList" class="flex flex-wrap gap-2">
                                <!-- æˆå‘˜å¤´åƒå°†åŠ¨æ€æ’å…¥ -->
                            </div>
                            <p id="memberMore" class="text-gray-500 text-sm mt-4 text-center"></p>
                        </div>

                        <!-- ç¤¾ç¾¤å…¬å‘Š -->
                        <div id="announcementSection" class="bg-white rounded-xl p-6 shadow-sm hidden">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-bullhorn text-orange-500 mr-2"></i>
                                ç¤¾ç¾¤å…¬å‘Š
                            </h2>
                            <div id="announcementContent" class="text-gray-700"></div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šåŠ å…¥ä¿¡æ¯ -->
                    <div class="space-y-6">
                        <!-- ç¤¾ç¾¤ç®¡ç† -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-user-shield text-indigo-500 mr-2"></i>
                                ç®¡ç†å›¢é˜Ÿ
                            </h2>
                            <div id="adminList" class="space-y-3">
                                <!-- ç®¡ç†å‘˜å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- ä¸‹è½½APPåŠ å…¥ -->
                        <div id="joinCard" class="bg-gradient-to-br from-teal-500 to-emerald-600 rounded-xl p-6 text-white">
                            <div class="text-center">
                                <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-user-plus text-2xl"></i>
                                </div>
                                <h3 class="font-bold text-lg mb-2">åŠ å…¥ç¤¾ç¾¤</h3>
                                <p class="text-white/80 text-sm mb-4">ä¸‹è½½APPåŠ å…¥ç¤¾ç¾¤ï¼Œå‚ä¸ç²¾å½©æ´»åŠ¨</p>
                                <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.8.apk" download
                                   class="block bg-white text-teal-600 py-3 rounded-xl font-bold hover:bg-teal-50 transition">
                                    <i class="fab fa-android mr-2"></i> ä¸‹è½½APPåŠ å…¥
                                </a>
                            </div>
                        </div>

                        <!-- ç¤¾ç¾¤æ ‡ç­¾ -->
                        <div id="tagsSection" class="bg-white rounded-xl p-6 shadow-sm hidden">
                            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-tags text-pink-500 mr-2"></i>
                                ç¤¾ç¾¤æ ‡ç­¾
                            </h2>
                            <div id="tagsList" class="flex flex-wrap gap-2">
                                <!-- æ ‡ç­¾å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- å…¥ç¾¤é¡»çŸ¥ -->
                        <div class="bg-teal-50 rounded-xl p-4 border border-teal-100">
                            <h4 class="font-medium text-teal-800 mb-2 flex items-center">
                                <i class="fas fa-hand-point-right mr-2"></i>
                                å…¥ç¾¤é¡»çŸ¥
                            </h4>
                            <ul id="joinRules" class="text-teal-700 text-sm space-y-1">
                                <li>â€¢ éµå®ˆç¤¾ç¾¤è§„åˆ™ï¼Œå‹å–„äº¤æµ</li>
                                <li>â€¢ ç¦æ­¢å‘å¸ƒå¹¿å‘Šã€è¿è§„å†…å®¹</li>
                                <li>â€¢ ç§¯æå‚ä¸ç¤¾ç¾¤æ´»åŠ¨</li>
                                <li>â€¢ äº’å¸®äº’åŠ©ï¼Œå…±åŒè¿›æ­¥</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å›ºå®šæ  -->
    <div id="bottomBar" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 z-40">
        <div class="container mx-auto flex items-center gap-3">
            <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/APK/dongyingyouxia_v1.5.8.apk" download
               class="flex-1 bg-gradient-to-r from-teal-500 to-emerald-600 text-white text-center py-3 rounded-xl font-bold hover:opacity-90 transition">
                <i class="fab fa-android mr-2"></i> ä¸‹è½½APPåŠ å…¥ç¤¾ç¾¤
            </a>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm mb-2">ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°</p>
            <p class="text-gray-500 text-xs">&copy; 2026 æ ªå¼ä¼šç¤¾æ˜‡é™½å•†äº‹</p>
        </div>
    </footer>

    <!-- APIé…ç½® -->
    <script src="api-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const type = getUrlParam('type'); // club æˆ– hometown
            const id = getUrlParam('id');

            if (!id) {
                showError();
                return;
            }

            try {
                let community;
                if (type === 'hometown') {
                    community = await getHometownById(id);
                    community._type = 'hometown';
                } else {
                    community = await getClubById(id);
                    community._type = 'club';
                }

                if (!community) {
                    showError();
                    return;
                }

                renderCommunity(community);

            } catch (err) {
                console.error('åŠ è½½ç¤¾ç¾¤å¤±è´¥:', err);
                showError();
            }
        });

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        function renderCommunity(community) {
            const isHometown = community._type === 'hometown';

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${community.name} - ${isHometown ? 'åŒä¹¡ä¼š' : 'ä¿±ä¹éƒ¨'}`;

            // æ›´æ¢å¤´éƒ¨æ¸å˜è‰²
            const header = document.getElementById('communityHeader');
            if (isHometown) {
                header.classList.remove('gradient-club');
                header.classList.add('gradient-hometown');
            }

            // ç¤¾ç¾¤å¤´åƒ
            document.getElementById('communityLogo').src = community.logo_url || community.cover_image || DEFAULT_AVATAR;

            // ç±»å‹æ ‡ç­¾
            const typeTag = document.getElementById('communityTypeTag');
            if (isHometown) {
                typeTag.textContent = `${community.china_province || ''}åŒä¹¡ä¼š`;
            } else {
                typeTag.textContent = getClubTypeName(community.club_type);
            }

            // åŸºæœ¬ä¿¡æ¯
            document.getElementById('communityName').textContent = community.name;
            document.getElementById('communitySlogan').textContent = community.slogan || community.description?.substring(0, 50) || 'æ¬¢è¿åŠ å…¥æˆ‘ä»¬ï¼';

            // ç»Ÿè®¡æ•°æ®
            document.getElementById('memberCount').innerHTML = `<i class="fas fa-users mr-1"></i>${community.member_count || 0} æˆå‘˜`;
            document.getElementById('createDate').innerHTML = `<i class="fas fa-calendar mr-1"></i>åˆ›å»ºäº ${formatDate(community.created_at)}`;
            document.getElementById('activityLevel').innerHTML = `<i class="fas fa-fire mr-1"></i>${getActivityLevel(community.activity_score)}`;

            // ç¤¾ç¾¤ç®€ä»‹
            document.getElementById('communityDescription').textContent = community.description || 'æš‚æ— ç®€ä»‹ï¼Œå¿«æ¥äº†è§£è¿™ä¸ªç²¾å½©çš„ç¤¾ç¾¤å§ï¼';

            // æˆå‘˜å±•ç¤ºï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
            const memberList = document.getElementById('memberList');
            const memberCount = community.member_count || 0;
            const displayCount = Math.min(memberCount, 20);
            let memberHtml = '';
            for (let i = 0; i < displayCount; i++) {
                memberHtml += `
                    <div class="member-avatar w-10 h-10 rounded-full bg-gradient-to-br from-gray-200 to-gray-300 border-2 border-white shadow-sm -ml-2 first:ml-0 overflow-hidden">
                        <img src="${DEFAULT_AVATAR}" alt="æˆå‘˜${i+1}" class="w-full h-full object-cover">
                    </div>
                `;
            }
            memberList.innerHTML = memberHtml;
            if (memberCount > 20) {
                document.getElementById('memberMore').textContent = `è¿˜æœ‰ ${memberCount - 20} ä½æˆå‘˜...`;
            }

            // ç®¡ç†å‘˜ï¼ˆä½¿ç”¨åˆ›å»ºè€…ä¿¡æ¯ï¼‰
            const adminList = document.getElementById('adminList');
            if (community.users || community.creator) {
                const admin = community.users || community.creator;
                adminList.innerHTML = `
                    <div class="flex items-center gap-3">
                        <img src="${admin.avatar_url || DEFAULT_AVATAR}" alt="ç®¡ç†å‘˜å¤´åƒ"
                             class="w-12 h-12 rounded-full object-cover border-2 border-indigo-100">
                        <div>
                            <p class="font-medium text-gray-800">${admin.nickname || 'ç¾¤ä¸»'}</p>
                            <p class="text-indigo-500 text-xs">
                                <i class="fas fa-crown mr-1"></i>ç¾¤ä¸»
                            </p>
                        </div>
                    </div>
                `;
            }

            // ç¤¾ç¾¤æ ‡ç­¾
            if (community.tags && community.tags.length > 0) {
                document.getElementById('tagsSection').classList.remove('hidden');
                document.getElementById('tagsList').innerHTML = community.tags.map(tag =>
                    `<span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm">${tag}</span>`
                ).join('');
            }

            // å…¬å‘Š
            if (community.announcement) {
                document.getElementById('announcementSection').classList.remove('hidden');
                document.getElementById('announcementContent').textContent = community.announcement;
            }

            // æ›´æ¢åŠ å…¥å¡ç‰‡é¢œè‰²
            if (isHometown) {
                const joinCard = document.getElementById('joinCard');
                joinCard.classList.remove('from-teal-500', 'to-emerald-600');
                joinCard.classList.add('from-rose-500', 'to-pink-600');
                joinCard.querySelector('a').classList.remove('text-teal-600');
                joinCard.querySelector('a').classList.add('text-rose-600');
            }

            // æ˜¾ç¤ºå†…å®¹
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
        }

        function getClubTypeName(type) {
            const types = {
                'interest': 'å…´è¶£çˆ±å¥½',
                'sports': 'è¿åŠ¨å¥èº«',
                'business': 'å•†åŠ¡ç¤¾äº¤',
                'parenting': 'äº²å­è‚²å„¿',
                'study': 'å­¦ä¹ äº¤æµ',
                'travel': 'æ—…æ¸¸æˆ·å¤–',
                'food': 'ç¾é£Ÿæ¢åº—',
                'pet': 'å® ç‰©',
                'game': 'æ¸¸æˆ',
                'other': 'å…¶ä»–'
            };
            return types[type] || type || 'ä¿±ä¹éƒ¨';
        }

        function getActivityLevel(score) {
            if (!score || score < 30) return 'å†·æ¸…';
            if (score < 60) return 'ä¸€èˆ¬';
            if (score < 80) return 'æ´»è·ƒ';
            return 'è¶…æ´»è·ƒ';
        }
    </script>
</body>

</html>
