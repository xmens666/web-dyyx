<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“è¯¦æƒ… - ä¾ å®¢å¸‚é›†</title>
    <meta name="description" content="ä¸œç€›æ¸¸ä¾ ä¾ å®¢å¸‚é›† - åœ¨æ—¥åäººäºŒæ‰‹äº¤æ˜“å¹³å°">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#EC4899">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-marketplace { background: linear-gradient(135deg, #EC4899 0%, #F43F5E 50%, #EF4444 100%); }
        .image-gallery img { cursor: pointer; transition: all 0.2s; }
        .image-gallery img:hover { opacity: 0.8; }
        .status-available { background: linear-gradient(135deg, #10B981, #059669); }
        .status-sold { background: linear-gradient(135deg, #6B7280, #4B5563); }
        .status-reserved { background: linear-gradient(135deg, #F59E0B, #D97706); }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed w-full bg-white/95 backdrop-blur-md shadow-sm z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <span class="text-lg font-bold text-gray-800">ğŸ¯ ä¸œç€›æ¸¸ä¾ </span>
            </a>
            <a href="marketplace.html" class="text-pink-500 text-sm hover:text-pink-600">
                <i class="fas fa-arrow-left mr-1"></i> è¿”å›å¸‚é›†
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="pt-16 pb-24">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading" class="flex flex-col items-center justify-center min-h-[60vh]">
            <div class="w-12 h-12 border-4 border-pink-500 border-t-transparent rounded-full loading-spinner"></div>
            <p class="mt-4 text-gray-500">æ­£åœ¨åŠ è½½å•†å“ä¿¡æ¯...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error" class="hidden flex flex-col items-center justify-center min-h-[60vh] px-4">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">å•†å“ä¸å­˜åœ¨</h2>
            <p class="text-gray-500 mb-6 text-center">è¯¥å•†å“å¯èƒ½å·²åˆ é™¤æˆ–é“¾æ¥æ— æ•ˆ</p>
            <a href="marketplace.html" class="bg-pink-500 text-white px-6 py-2 rounded-full hover:bg-pink-600 transition">
                è¿”å›å¸‚é›†
            </a>
        </div>

        <!-- å•†å“å†…å®¹ -->
        <div id="content" class="hidden fade-in">
            <div class="container mx-auto px-4 py-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- å·¦ä¾§ï¼šå›¾ç‰‡åŒºåŸŸ -->
                    <div>
                        <!-- ä¸»å›¾ -->
                        <div class="relative bg-white rounded-2xl overflow-hidden shadow-sm mb-4">
                            <img id="mainImage" src="" alt="å•†å“å›¾ç‰‡"
                                 class="w-full aspect-square object-contain bg-gray-50">
                            <!-- çŠ¶æ€æ ‡ç­¾ -->
                            <div id="statusBadge" class="absolute top-4 right-4 px-4 py-2 rounded-full text-white font-bold text-sm shadow-lg">
                            </div>
                            <!-- æ€¥å”®æ ‡ç­¾ -->
                            <div id="urgentBadge" class="hidden absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                <i class="fas fa-fire mr-1"></i>æ€¥å”®
                            </div>
                        </div>
                        <!-- ç¼©ç•¥å›¾ -->
                        <div id="thumbnails" class="image-gallery grid grid-cols-5 gap-2">
                            <!-- ç¼©ç•¥å›¾å°†åŠ¨æ€æ’å…¥ -->
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šå•†å“ä¿¡æ¯ -->
                    <div>
                        <!-- å•†å“æ ‡é¢˜ -->
                        <h1 id="itemTitle" class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2"></h1>

                        <!-- æ ‡ç­¾åŒºåŸŸ -->
                        <div id="tagsContainer" class="flex flex-wrap gap-2 mb-4">
                            <!-- æ ‡ç­¾å°†åŠ¨æ€æ’å…¥ -->
                        </div>

                        <!-- ä»·æ ¼åŒºåŸŸ -->
                        <div class="bg-gradient-to-r from-pink-50 to-red-50 rounded-xl p-4 mb-6">
                            <div class="flex items-baseline gap-2 flex-wrap">
                                <span class="text-3xl sm:text-4xl font-bold text-pink-500" id="itemPrice"></span>
                                <span id="originalPrice" class="hidden text-lg text-gray-400 line-through"></span>
                                <span id="discountBadge" class="hidden bg-red-500 text-white text-xs px-2 py-1 rounded-full"></span>
                                <span id="negotiableBadge" class="hidden bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full">å¯è®®ä»·</span>
                            </div>
                            <div class="flex items-center gap-4 mt-3 text-sm text-gray-500 flex-wrap">
                                <span id="viewCount"><i class="fas fa-eye mr-1"></i></span>
                                <span id="favoriteCount"><i class="fas fa-heart mr-1"></i></span>
                                <span id="postTime"><i class="fas fa-clock mr-1"></i></span>
                            </div>
                        </div>

                        <!-- å•†å“å±æ€§ -->
                        <div class="bg-white rounded-xl p-4 border border-gray-100 mb-6">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-tags text-pink-500 mr-2"></i>å•†å“å±æ€§
                            </h3>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex items-center">
                                    <span class="text-gray-500 w-16">æˆè‰²</span>
                                    <span id="itemCondition" class="text-gray-800 font-medium"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-gray-500 w-16">åˆ†ç±»</span>
                                    <span id="itemCategory" class="text-gray-800"></span>
                                </div>
                                <div id="mainCategoryRow" class="hidden flex items-center">
                                    <span class="text-gray-500 w-16">ä¸»ç±»</span>
                                    <span id="mainCategory" class="text-gray-800"></span>
                                </div>
                                <div id="subCategoryRow" class="hidden flex items-center">
                                    <span class="text-gray-500 w-16">å­ç±»</span>
                                    <span id="subCategory" class="text-gray-800"></span>
                                </div>
                            </div>
                        </div>

                        <!-- äº¤æ˜“ä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-4 border border-gray-100 mb-6">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-truck text-blue-500 mr-2"></i>äº¤æ˜“æ–¹å¼
                            </h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex items-start">
                                    <span class="text-gray-500 w-20 flex-shrink-0">äº¤æ˜“æ–¹å¼</span>
                                    <span id="itemDelivery" class="text-gray-800"></span>
                                </div>
                                <div id="shippingFeeRow" class="hidden flex items-start">
                                    <span class="text-gray-500 w-20 flex-shrink-0">å¿«é€’è¿è´¹</span>
                                    <span id="shippingFee" class="text-gray-800"></span>
                                </div>
                                <div id="localDeliveryRow" class="hidden flex items-start">
                                    <span class="text-gray-500 w-20 flex-shrink-0">æœ¬åœ°é…é€</span>
                                    <span id="localDelivery" class="text-gray-800"></span>
                                </div>
                                <div id="deliveryAreasRow" class="hidden flex items-start">
                                    <span class="text-gray-500 w-20 flex-shrink-0">é…é€èŒƒå›´</span>
                                    <span id="deliveryAreas" class="text-gray-800"></span>
                                </div>
                                <div id="codRow" class="hidden flex items-start">
                                    <span class="text-gray-500 w-20 flex-shrink-0">è´§åˆ°ä»˜æ¬¾</span>
                                    <span id="codStatus" class="text-green-600 font-medium">æ”¯æŒ</span>
                                </div>
                            </div>
                        </div>

                        <!-- æ”¯ä»˜æ–¹å¼ -->
                        <div id="paymentSection" class="hidden bg-white rounded-xl p-4 border border-gray-100 mb-6">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-credit-card text-green-500 mr-2"></i>æ”¯ä»˜æ–¹å¼
                            </h3>
                            <div id="paymentMethods" class="flex flex-wrap gap-2">
                                <!-- æ”¯ä»˜æ–¹å¼å°†åŠ¨æ€æ’å…¥ -->
                            </div>
                        </div>

                        <!-- ä½ç½®ä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-4 border border-gray-100 mb-6">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ä½ç½®ä¿¡æ¯
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-start">
                                    <span class="text-gray-500 w-16 flex-shrink-0">åœ°åŒº</span>
                                    <span id="itemLocation" class="text-gray-800"></span>
                                </div>
                                <div id="locationDetailRow" class="hidden flex items-start">
                                    <span class="text-gray-500 w-16 flex-shrink-0">è¯¦ç»†</span>
                                    <span id="locationDetail" class="text-gray-800"></span>
                                </div>
                            </div>
                        </div>

                        <!-- è”ç³»æ–¹å¼ -->
                        <div id="contactSection" class="hidden bg-white rounded-xl p-4 border border-gray-100 mb-6">
                            <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-address-book text-purple-500 mr-2"></i>è”ç³»æ–¹å¼
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div id="phoneRow" class="hidden flex items-center">
                                    <span class="text-gray-500 w-16">ç”µè¯</span>
                                    <span id="contactPhone" class="text-gray-800"></span>
                                </div>
                                <div id="wechatRow" class="hidden flex items-center">
                                    <span class="text-gray-500 w-16">å¾®ä¿¡</span>
                                    <span id="contactWechat" class="text-gray-800"></span>
                                </div>
                            </div>
                        </div>

                        <!-- å–å®¶ä¿¡æ¯ -->
                        <div class="bg-white rounded-xl p-4 border border-gray-100 mb-6">
                            <div class="flex items-center gap-3">
                                <img id="sellerAvatar" src="" alt="å–å®¶å¤´åƒ"
                                     class="w-14 h-14 rounded-full object-cover border-2 border-gray-100">
                                <div class="flex-1">
                                    <h4 id="sellerName" class="font-medium text-gray-800"></h4>
                                    <p id="sellerInfo" class="text-gray-500 text-sm"></p>
                                </div>
                                <a href="" id="sellerLink" class="text-pink-500 text-sm hover:text-pink-600">
                                    æŸ¥çœ‹ä¸»é¡µ <i class="fas fa-chevron-right ml-1"></i>
                                </a>
                            </div>
                        </div>

                        <!-- ä¸‹è½½APPæç¤º -->
                        <div class="bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl p-6 text-white">
                            <div class="text-center">
                                <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-comments text-2xl"></i>
                                </div>
                                <h3 class="font-bold text-lg mb-2">è”ç³»å–å®¶è´­ä¹°</h3>
                                <p class="text-white/80 text-sm mb-4">ä¸‹è½½APPä¸å–å®¶ç§èŠï¼Œäº«å—å¹³å°æ‹…ä¿äº¤æ˜“</p>
                                <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/dongyingyouxia_v1.4.5_test.apk" download
                                   class="block bg-white text-pink-600 py-3 rounded-xl font-bold hover:bg-pink-50 transition">
                                    <i class="fab fa-android mr-2"></i> ä¸‹è½½APPè´­ä¹°
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å•†å“è¯¦æƒ…æè¿° -->
                <div class="mt-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-info-circle text-pink-500 mr-2"></i>
                        å•†å“è¯¦æƒ…
                    </h2>
                    <div id="itemDescription" class="bg-white rounded-xl p-6 shadow-sm">
                        <!-- å•†å“æè¿°å°†åŠ¨æ€æ’å…¥ -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å›ºå®šæ  -->
    <div id="bottomBar" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 z-40">
        <div class="container mx-auto flex items-center justify-between gap-4">
            <div class="flex-shrink-0">
                <p class="text-gray-500 text-xs">äºŒæ‰‹ä»·æ ¼</p>
                <div class="flex items-baseline gap-1">
                    <p class="text-pink-500 font-bold text-xl" id="bottomPrice"></p>
                    <span id="bottomNegotiable" class="hidden text-xs text-orange-500">å¯è®®</span>
                </div>
            </div>
            <a href="https://pub-3e154ce6d5c8487f833628106145e7a2.r2.dev/dongyingyouxia_v1.4.5_test.apk" download
               class="flex-1 bg-gradient-to-r from-pink-500 to-rose-600 text-white text-center py-3 rounded-xl font-bold hover:opacity-90 transition">
                <i class="fab fa-android mr-2"></i> ä¸‹è½½APPè´­ä¹°
            </a>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm mb-2">ä¸œç€›æ¸¸ä¾  - åœ¨æ—¥åäººçš„ç”Ÿæ´»æœåŠ¡å¹³å°</p>
            <p class="text-gray-500 text-xs">&copy; 2026 æ ªå¼ä¼šç¤¾æ˜‡é™½å•†äº‹</p>
        </div>
    </footer>

    <!-- APIé…ç½® -->
    <script src="api-config.js"></script>
    <script>
        let currentImageIndex = 0;
        let itemImages = [];

        document.addEventListener('DOMContentLoaded', async () => {
            const itemId = getUrlParam('id');

            if (!itemId) {
                showError();
                return;
            }

            try {
                const item = await getMarketplaceItemById(itemId);

                if (!item) {
                    showError();
                    return;
                }

                renderItem(item);

            } catch (err) {
                console.error('åŠ è½½å•†å“å¤±è´¥:', err);
                showError();
            }
        });

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        function renderItem(item) {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${item.title} - ä¾ å®¢å¸‚é›†`;

            // å¤„ç†å›¾ç‰‡
            itemImages = [];
            if (item.images && item.images.length > 0) {
                itemImages = item.images;
            } else {
                itemImages = [DEFAULT_PRODUCT_IMAGE];
            }

            // ä¸»å›¾
            document.getElementById('mainImage').src = itemImages[0];

            // ç¼©ç•¥å›¾
            const thumbnails = document.getElementById('thumbnails');
            if (itemImages.length > 1) {
                thumbnails.innerHTML = itemImages.map((img, index) => `
                    <img src="${img}" alt="ç¼©ç•¥å›¾${index + 1}"
                         class="aspect-square object-cover rounded-lg border-2 ${index === 0 ? 'border-pink-500' : 'border-transparent'}"
                         onclick="switchImage(${index})"
                         onerror="this.src='${DEFAULT_PRODUCT_IMAGE}'">
                `).join('');
            }

            // çŠ¶æ€æ ‡ç­¾
            const statusBadge = document.getElementById('statusBadge');
            const statusMap = {
                'available': { text: 'åœ¨å”®ä¸­', class: 'status-available' },
                'sold': { text: 'å·²å”®å‡º', class: 'status-sold' },
                'reserved': { text: 'å·²é¢„å®š', class: 'status-reserved' }
            };
            const status = statusMap[item.status] || statusMap['available'];
            statusBadge.textContent = status.text;
            statusBadge.classList.add(status.class);

            // æ€¥å”®æ ‡ç­¾
            if (item.is_urgent) {
                document.getElementById('urgentBadge').classList.remove('hidden');
            }

            // å•†å“æ ‡é¢˜
            document.getElementById('itemTitle').textContent = item.title;

            // æ ‡ç­¾
            const tagsContainer = document.getElementById('tagsContainer');
            if (item.tags && item.tags.length > 0) {
                tagsContainer.innerHTML = item.tags.map(tag =>
                    `<span class="bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full">#${tag}</span>`
                ).join('');
            }

            // ä»·æ ¼
            document.getElementById('itemPrice').textContent = formatPrice(item.price);
            document.getElementById('bottomPrice').textContent = formatPrice(item.price);

            // åŸä»·å’ŒæŠ˜æ‰£
            if (item.original_price && item.original_price > item.price) {
                document.getElementById('originalPrice').textContent = formatPrice(item.original_price);
                document.getElementById('originalPrice').classList.remove('hidden');

                const discount = Math.round((1 - item.price / item.original_price) * 100);
                document.getElementById('discountBadge').textContent = `${discount}% OFF`;
                document.getElementById('discountBadge').classList.remove('hidden');
            }

            // è®®ä»·æ ‡ç­¾
            if (item.is_negotiable) {
                document.getElementById('negotiableBadge').classList.remove('hidden');
                document.getElementById('bottomNegotiable').classList.remove('hidden');
            }

            // æµè§ˆé‡ã€æ”¶è—ã€å‘å¸ƒæ—¶é—´
            document.getElementById('viewCount').innerHTML = `<i class="fas fa-eye mr-1"></i>${item.view_count || 0} æµè§ˆ`;
            document.getElementById('favoriteCount').innerHTML = `<i class="fas fa-heart mr-1"></i>${item.favorite_count || 0} æ”¶è—`;
            document.getElementById('postTime').innerHTML = `<i class="fas fa-clock mr-1"></i>${formatDate(item.created_at)}`;

            // å•†å“å±æ€§
            document.getElementById('itemCondition').textContent = getConditionName(item.condition);
            document.getElementById('itemCategory').textContent = getCategoryName(item.category);

            // ä¸»åˆ†ç±»/å­åˆ†ç±»
            if (item.main_category) {
                document.getElementById('mainCategoryRow').classList.remove('hidden');
                document.getElementById('mainCategory').textContent = item.main_category;
            }
            if (item.sub_category) {
                document.getElementById('subCategoryRow').classList.remove('hidden');
                document.getElementById('subCategory').textContent = item.sub_category;
            }

            // äº¤æ˜“æ–¹å¼
            document.getElementById('itemDelivery').textContent = getDeliveryName(item.delivery_method);

            // è¿è´¹
            if (item.shipping_fee !== null && item.shipping_fee !== undefined) {
                document.getElementById('shippingFeeRow').classList.remove('hidden');
                document.getElementById('shippingFee').textContent = item.shipping_fee > 0 ? `Â¥${item.shipping_fee}` : 'åŒ…é‚®';
            }

            // æœ¬åœ°é…é€
            if (item.local_delivery_fee !== null || item.local_delivery_range) {
                document.getElementById('localDeliveryRow').classList.remove('hidden');
                let localText = [];
                if (item.local_delivery_fee !== null) {
                    localText.push(item.local_delivery_fee > 0 ? `é…é€è´¹Â¥${item.local_delivery_fee}` : 'å…è´¹é…é€');
                }
                if (item.local_delivery_range) {
                    localText.push(`èŒƒå›´: ${item.local_delivery_range}`);
                }
                document.getElementById('localDelivery').textContent = localText.join(' / ');
            }

            // é…é€åŒºåŸŸ
            if (item.delivery_areas && item.delivery_areas.length > 0) {
                document.getElementById('deliveryAreasRow').classList.remove('hidden');
                document.getElementById('deliveryAreas').textContent = item.delivery_areas.join('ã€');
            }

            // è´§åˆ°ä»˜æ¬¾
            if (item.is_shipping_cod) {
                document.getElementById('codRow').classList.remove('hidden');
            }

            // æ”¯ä»˜æ–¹å¼
            if (item.payment_method && item.payment_method.length > 0) {
                document.getElementById('paymentSection').classList.remove('hidden');
                const paymentContainer = document.getElementById('paymentMethods');
                const paymentIcons = {
                    'wechat': { icon: 'fab fa-weixin', color: 'text-green-500', name: 'å¾®ä¿¡' },
                    'alipay': { icon: 'fab fa-alipay', color: 'text-blue-500', name: 'æ”¯ä»˜å®' },
                    'cash': { icon: 'fas fa-money-bill', color: 'text-green-600', name: 'ç°é‡‘' },
                    'credit_card': { icon: 'fas fa-credit-card', color: 'text-orange-500', name: 'ä¿¡ç”¨å¡' },
                    'paypay': { icon: 'fas fa-mobile-alt', color: 'text-red-500', name: 'PayPay' },
                    'bank_transfer': { icon: 'fas fa-university', color: 'text-gray-600', name: 'é“¶è¡Œè½¬è´¦' }
                };
                paymentContainer.innerHTML = item.payment_method.map(method => {
                    const p = paymentIcons[method] || { icon: 'fas fa-wallet', color: 'text-gray-500', name: method };
                    return `<span class="flex items-center gap-1 bg-gray-100 px-3 py-1.5 rounded-full text-sm">
                        <i class="${p.icon} ${p.color}"></i>${p.name}
                    </span>`;
                }).join('');
            }

            // ä½ç½®ä¿¡æ¯
            const locationParts = [];
            if (item.region) locationParts.push(item.region);
            if (item.prefecture) locationParts.push(item.prefecture);
            if (item.city) locationParts.push(item.city);
            if (item.location_city && locationParts.length === 0) locationParts.push(item.location_city);

            document.getElementById('itemLocation').textContent = locationParts.join(' / ') || 'æœªæŒ‡å®š';

            if (item.location_detail) {
                document.getElementById('locationDetailRow').classList.remove('hidden');
                document.getElementById('locationDetail').textContent = item.location_detail;
            }

            // è”ç³»æ–¹å¼
            if (item.contact_phone || item.contact_wechat) {
                document.getElementById('contactSection').classList.remove('hidden');

                if (item.contact_phone) {
                    document.getElementById('phoneRow').classList.remove('hidden');
                    document.getElementById('contactPhone').textContent = item.contact_phone;
                }

                if (item.contact_wechat) {
                    document.getElementById('wechatRow').classList.remove('hidden');
                    document.getElementById('contactWechat').textContent = item.contact_wechat;
                }
            }

            // å–å®¶ä¿¡æ¯
            if (item.users) {
                const user = item.users;
                document.getElementById('sellerAvatar').src = user.avatar_url || DEFAULT_AVATAR;
                document.getElementById('sellerAvatar').onerror = function() { this.src = DEFAULT_AVATAR; };
                document.getElementById('sellerName').textContent = user.nickname || 'å–å®¶';
                document.getElementById('sellerInfo').textContent = `å‘å¸ƒäº†å¤šä»¶å•†å“`;
                document.getElementById('sellerLink').href = `seller.html?id=${user.id}`;
            }

            // å•†å“æè¿°
            const descriptionEl = document.getElementById('itemDescription');
            if (item.description) {
                descriptionEl.innerHTML = `<p class="text-gray-700 whitespace-pre-wrap leading-relaxed">${item.description}</p>`;
            } else {
                descriptionEl.innerHTML = '<p class="text-gray-400">æš‚æ— è¯¦ç»†æè¿°</p>';
            }

            // æ˜¾ç¤ºå†…å®¹
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
        }

        function switchImage(index) {
            currentImageIndex = index;
            document.getElementById('mainImage').src = itemImages[index];

            const thumbs = document.querySelectorAll('#thumbnails img');
            thumbs.forEach((thumb, i) => {
                if (i === index) {
                    thumb.classList.remove('border-transparent');
                    thumb.classList.add('border-pink-500');
                } else {
                    thumb.classList.remove('border-pink-500');
                    thumb.classList.add('border-transparent');
                }
            });
        }

        function getConditionName(condition) {
            const conditions = {
                'new': 'å…¨æ–°æœªæ‹†å°',
                'like_new': 'å‡ ä¹å…¨æ–°',
                'good': 'æˆè‰²è‰¯å¥½',
                'fair': 'æœ‰ä½¿ç”¨ç—•è¿¹',
                'poor': 'åŠŸèƒ½æ­£å¸¸',
                // æ–°æ ¼å¼ï¼š10åˆ†åˆ¶æˆè‰²
                '10_out_of_10': '10æˆæ–°ï¼ˆå…¨æ–°ï¼‰',
                '9_out_of_10': '9æˆæ–°',
                '8_out_of_10': '8æˆæ–°',
                '7_out_of_10': '7æˆæ–°',
                '6_out_of_10': '6æˆæ–°',
                '5_out_of_10': '5æˆæ–°ä»¥ä¸‹'
            };
            return conditions[condition] || condition || 'æœªæ ‡æ³¨';
        }

        function getCategoryName(category) {
            const categories = {
                // ä¸»è¦åˆ†ç±»
                'electronics': 'æ•°ç ç”µå™¨',
                'fashion': 'æœé¥°é‹åŒ…',
                'home': 'å®¶å±…ç”¨å“',
                'baby': 'æ¯å©´ç”¨å“',
                'sports': 'è¿åŠ¨æˆ·å¤–',
                'books': 'å›¾ä¹¦å½±éŸ³',
                'beauty': 'ç¾å¦†æŠ¤è‚¤',
                'food': 'é£Ÿå“é¥®æ–™',
                'car': 'æ±½è½¦ç”¨å“',
                'furniture': 'å®¶å…·',
                'appliances': 'å®¶ç”µ',
                'digital': 'æ•°ç äº§å“',
                'other': 'å…¶ä»–',
                // æ‰©å±•åˆ†ç±»
                'clothing': 'æœè£…',
                'shoes': 'é‹å­',
                'bags': 'ç®±åŒ…',
                'accessories': 'é…é¥°',
                'watches': 'æ‰‹è¡¨',
                'jewelry': 'ç å®é¦–é¥°',
                'phones': 'æ‰‹æœº',
                'computers': 'ç”µè„‘',
                'tablets': 'å¹³æ¿',
                'cameras': 'ç›¸æœº',
                'games': 'æ¸¸æˆæœº',
                'toys': 'ç©å…·',
                'pets': 'å® ç‰©ç”¨å“',
                'office': 'åŠå…¬ç”¨å“',
                'musical': 'ä¹å™¨',
                'art': 'è‰ºæœ¯å“',
                'collectibles': 'æ”¶è—å“',
                'tickets': 'ç¥¨åˆ¸',
                'services': 'æœåŠ¡'
            };
            return categories[category] || category || 'å…¶ä»–';
        }

        function getDeliveryName(method) {
            if (!method) return 'å½“é¢äº¤æ˜“';

            // å¦‚æœæ˜¯æ•°ç»„
            if (Array.isArray(method)) {
                const methodMap = {
                    'face_to_face': 'å½“é¢äº¤æ˜“',
                    'pickup': 'è‡ªå–',
                    'shipping': 'å¿«é€’é‚®å¯„',
                    'local_delivery': 'æœ¬åœ°é…é€',
                    'both': 'æ”¯æŒå¿«é€’/è‡ªå–'
                };
                return method.map(m => methodMap[m] || m).join('ã€');
            }

            const methods = {
                'face_to_face': 'å½“é¢äº¤æ˜“',
                'shipping': 'å¿«é€’é‚®å¯„',
                'both': 'æ”¯æŒå¿«é€’/è‡ªå–'
            };
            return methods[method] || method || 'å½“é¢äº¤æ˜“';
        }
    </script>
</body>

</html>
